# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v4
      
      # Sets up a Python environment
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10.13'
        
      # Installs system dependencies
      - name: Install system dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y portaudio19-dev

      # Installs dependencies
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -e .
      
      # Google Cloud SDK
      - id: 'auth'
        uses: 'google-github-actions/auth@v2'
        with:
          credentials_json: '{"type": "service_account","project_id": "senior-design-404616","private_key_id": "389ed1dbae070e5d2cf81aaeaaa34182dadb6c1b","private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCtrA9SGluuFJhJ\ntk7zt0TFxKxLGGoycfBheGRdZgDhpUNV/uq93CZkFvnb1jhpTIdTunryW8LzwvYD\nxCxcx5Cq6U6Y5wU1NUjbRY41JP5/2kM/9dO7Psk5BDAottHKXaru7UsHmjuxGJBj\nowul6PqFvwWqhg0IlLHvCodmrPXwPCnUeUu/jKrdfXS7+W9wbvScbbrG85DhuA8c\n/jOCV/o4sv7PdcmUUHDnsBfNXWHd6aOENrmzGsef1g0hQQBTgvppbs8bMT4bgSK1\nkHmBt6mdk64dw4vr4i7b0YRU3QEpy31T18D36JyXBps5MnIiku4asHeP5mjUXgLh\nT37ManMzAgMBAAECggEAB9ayQlRqOus3DGysF5f4BK0h0anicTBvVxbmAMkv1P9u\nkJ0W30bmfLIEyQVcOnR3zzGlhvbZT8NG81iRYAap4uzw3TngJEypYyw6hO+MhRzG\n2EYyLkthLa+gtNW7llSv+GTBdDBj7VRcgALF7dEcLZk3mkC+qdp8RXvGLL41w4gA\nZQ7GwFlcUmZGBq+AFpD82lvqudAFIlOOKN36HZ9F1Dr4ocnR1+Tio8PsYSOFlW1U\nBfYZV9LYGFkKdj6OCc6IrqJ/2oNjMLyFO4nwhJSbIE6mARtpI4QGZv84xyA+BOFy\nhj/FBW7N7oVsfOcaysecg1HPgH2gRMdkjoMUZxq8QQKBgQD0g2CFHvs1YPmnUPgw\nyngnNR5uynHczrgkvRegL+w93b1oTOVQxV19pcFBH7xOxUPEYlZOvAgZ2N3pqUxs\nP6n5a24cqGvREhGAh5hwSkukOL4bT3j9Dro3bukxyMOVne5ZwOuBnHVI/Dxr8x88\nsifz00V6bpQSzNSpvbMDNeVa4wKBgQC11LeEEDOWDE0RtJvrjzI48u076ZNG0xHf\n8+F4hxfVq2B7nYb73LuwNycUjXFpjyK3jmS3/zEmUVfJhg+OVZKDku5OqS/m4aaB\ndd9zy31a/o7AsiDSdj1vzrxgiZZ3C9LOGADoiPz88ejoR1JpuOhbIPbGPA2NurbB\nWPRVUbRncQKBgQC+dp/20j1IRTPzO0U5bF3P3LbKAnRTVctnAsymgO36+wERf+SY\n2ESNHVK+UeQzT8IL9bXZOursh1vFKZVYNPdITIDHXgIuJ27uubDqt1TYpUKgr3VF\nWfWAPKr1lreTkiQaUgahPai2o5TFWeqZMwWgDpBuYDiDtH5rglMxSwhPlQKBgBnx\nswml4iZrtOds1L6EnQ7hIpZk2n3FigxhWO+Anxb+r/KTZHo1YZZgGDRnhiIgqTx1\nlctnHxUvkA4SEdAmR5R8d4JDw7D2y3I3Zl24UDeWkLnP8Lz24Ac/AUPo/c4YosiD\nRkXnneldfvT9kDXDi2vNRUi9stVhKchmr94onUwRAoGAQZlyoyGAp2A1iMTjKNon\n3PY+TrfD+5rmZtiT4XTfvJx/gDteQ7MTb+fjgxEaPAisCtkL7RsyvWXr9uGK71e8\niGbM1V9/+xoTAvwqSjXBi/dn7yZCQgnNkNpAh8M8Xu6sELd7hROTWeUyOLr/V7Eq\nhuZGHdiKX4Fm/1QwfIYndRA=\n-----END PRIVATE KEY-----\n","client_email": "service-stt@senior-design-404616.iam.gserviceaccount.com","client_id": "102690469308281473104","auth_uri": "https://accounts.google.com/o/oauth2/auth","token_uri": "https://oauth2.googleapis.com/token","auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs","client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/service-stt%40senior-design-404616.iam.gserviceaccount.com","universe_domain": "googleapis.com"}'

      - name: 'Set up Cloud SDK'
        uses: 'google-github-actions/setup-gcloud@v2'

      - name: 'Use gcloud CLI'
        run: 'gcloud info'

      # Runs tests
      - name: Run tests
        run: |
          python -m pip install pytest
          export PYTHONPATH=".:$PYTHONPATH"
          pytest tests
      
      # linter
      - name: lint with ruff
        run: |
          pip install ruff
          ruff check .

